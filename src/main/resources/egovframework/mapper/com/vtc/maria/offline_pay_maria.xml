<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="offlinePay">

	<select id="getAccountMenu" parameterType="String" resultType="Map">
	<![CDATA[
		SELECT PKID, BankName, Account, ACName 
		FROM tblBANK 
		WHERE IsDelete = 'N' 
		ORDER BY SortOrder 
	]]>
	</select>

	<select id="getCreditCardMenu" parameterType="String" resultType="Map">
	<![CDATA[
		SELECT Code, CreditName
		FROM tblCreditCard
		WHERE 
			SiteCode = #{SiteCode}
		and IsDelete = 'N'
		ORDER BY SortOrder ASC
	]]>
	</select>

	<insert id="insertElecAssignData" parameterType="Map">
	<![CDATA[
	INSERT INTO tblelecassigndata
		(SiteCode, PayType, AssignType, ResponseCode, Price, ValidDate, Halbu, AssignNo, CardName, Maeipsa, Msg1, Msg2, Msg3, SignPad, AssignTime, IsPos, IsConfirm, MemberID, MemberName, SaleType, FPKID, RegisterID, IsDelete, UpdDate, UpdUserPKID)
		VALUES(
		  #{SiteCode}
		, #{PayType}
		, #{AssignType}
		, #{responseCode}
		, #{Price}
		, #{ValidDate}
		, #{Halbu}
		, #{AssignNo}
		, #{CardName}
		, #{CompanyName}
		, #{msg1}
		, #{msg2}
		, #{msg3}
		, #{SignGubun}
		, #{SaleDate}
		, #{IsPos}
		, #{Isconfirm}
		, #{MemberID}
		, #{MemberName}
		, #{SaleType}
		, 0
		, 0
		, 'N'
		, date_format(NOW(), '%Y-%m-%d %T' )
		, #{userPKID});
	
	]]>
	</insert>
	
	<select id="insertPaidFmsc_s01" statementType="CALLABLE" parameterType="Map">
		<![CDATA[
			{call SP_InsertPaidFmsc_S01( #{SiteCode, mode=IN}, #{PayType, mode=IN}, #{AssignType, mode=IN}, #{responseCode, mode=IN}, #{Price, mode=IN}, #{CardNo, mode=IN}
			, #{ValidDate, mode=IN}, #{Halbu, mode=IN}, #{AssignNo, mode=IN}, #{CardName, mode=IN}, #{CompanyName, mode=IN}, #{msg1, mode=IN}, #{msg2, mode=IN}, #{signGubun, mode=IN}
			, #{SaleDate, mode=IN}, #{IsPos, mode=IN}, #{MemberID, mode=IN}, #{SaleType, mode=IN}, #{userPKID, mode=IN}, #{OID, mode=IN}, #{TID, mode=IN}
			, #{tempSaleNo, mode=IN}, #{ReceiptNo, mode=IN}, #{InsertYN, mode=IN}, #{SaleNo, mode=OUT, jdbcType=INTEGER}, #{paidPKID, mode=OUT, jdbcType=INTEGER} )}
		]]>
	</select>
	
	<select id="insertFMSC_S01" parameterType="Map" resultType="Map">
		<![CDATA[
			{call SP_InsertFMSC_S01_NEW(#{SiteCode},#{SaleType},#{tempSaleNo},#{userPKID})}
		]]>
	</select>
	
	<select id="insertPaidLocker" parameterType="Map" resultType="Map">
		<![CDATA[
			{call SP_InsertuseLocker(#{SiteCode},#{MemberID},#{tempSaleNo},#{userPKID})}	
		]]>
	</select>
	
	<select id="insertPaid" statementType="CALLABLE" parameterType="Map">
		<![CDATA[
			{call SP_InsertPaid( #{SiteCode, mode=IN}, #{PayType, mode=IN}, #{AssignType, mode=IN}, #{responseCode, mode=IN}, #{Price, mode=IN}, #{CardNo, mode=IN}
			, #{ValidDate, mode=IN}, #{Halbu, mode=IN}, #{AssignNo, mode=IN}, #{CardName, mode=IN}, #{CompanyName, mode=IN}, #{msg1, mode=IN}, #{msg2, mode=IN}, #{signGubun, mode=IN}
			, #{SaleDate, mode=IN}, #{IsPos, mode=IN}, #{MemberID, mode=IN}, #{SaleType, mode=IN}, #{userPKID, mode=IN}, #{OID, mode=IN}, #{TID, mode=IN}
			, #{tempSaleNo, mode=IN}, #{ReceiptNo, mode=IN}, #{paidPKID, mode=OUT, jdbcType=INTEGER} )}
		]]>
	</select>
	<update id="insertPaidCancelLocker" parameterType="map">
		update tblpaid set OriginPKID = #{pkid}
		where 
			FPKID = 
			(select FPKID  from tblpaid
			where
				PKID = #{pkid}
			and SiteCode = #{SiteCode}
			and IsDelete = 'N')
		and SiteCode = #{SiteCode}
		and IsDelete = 'N' 
		order by PKID desc
		limit 1
	</update>
</mapper>